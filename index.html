<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dark Matter Sheet</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="top-row">
            <div class="player-name border">
                <div class="name-container">
                    <div class="name-label">Name</div>
                    <div class="name-input"><input type="text" name="attr_character_name" placeholder="Character Name" /></div>
                </div>
            </div>
            <div class="character-name border">
                <div class="character-row">
                    <div style="flex-grow: 2; margin: 0px 8px;"><input style="text-align: center" type="text" name="attr_class_and_level" placeholder="Class and Level" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_player_name" placeholder="player name" /></div>
                </div>
                <div class="character-row">
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_race" placeholder="race" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_background" placeholder="background" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_alignment" placeholder="alignment" /></div>
                </div>
                <div class="character-row">
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_xp" placeholder="xp" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_size" placeholder="size" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_gender" placeholder="gender" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_age" placeholder="age" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_height" placeholder="height" /></div>
                    <div style="flex-grow: 1; margin: 0px 8px"><input style="text-align: center" type="text" name="attr_weight" placeholder="weight" /></div>
                </div>
            </div>
        </div>
        <div class="middle-row">
            <div style="flex-grow: 1">
                <div class="left trait-block">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Personality Traits</div>
                    <div><textarea name="attr_personality_traits" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="left trait-block">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Ideals</div>
                    <div><textarea name="attr_ideals" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="left trait-block">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Bonds</div>
                    <div><textarea name="attr_bonds" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="left trait-block">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Allies/Enemies</div>
                    <div><textarea name="attr_allies_and_enemies" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="box-rounded">
                    <div>Strength Saving Throws</div>
                    <input type="text" name="attr_strength_saving_Throws" />
                </div>
                <div class="box-rounded">
                    <div>Dexterity Saving Throws</div>
                    <input type="text" name="attr_dexterity_saving_Throws" />
                </div>
                <div class="box-rounded">
                    <div>Wisdom saving throws</div> 
                    <input type="text" name="attr_wisdom_saving_throws" />
                </div>
                <div class="box-rounded">
                    <div>Constitution saving throws</div> 
                    <input type="text" name="attr_constitution_saving_throws" />
                </div>
                <div class="box-rounded">
                    <div>Intelligence saving throws</div> 
                    <input type="text" name="attr_intelligence_saving_throws" />
                </div>
            </div>
            <div style="flex-grow: 2">
                <div style="display: flex; margin:auto; margin: 16px 0px">
                    <div style="border: 5px solid #ccc">Inspiration</div>
                    <input style="width: 150px" type="text" name="attr_inspiration" />
                </div>
                <div style="margin-bottom: 32px; display: flex">
                    <div class="ac-shield">
                        <input class="ac" name="attr_ac" type="number" />
                        <input class="alt" name="attr_ac_alt" type="number" />
                    </div>
                    <div style="flex-grow:1; font-size: 0.5rem; text-align: center">
                        <div class="box-rounded">
                            <div>Inititive</div>
                            <div><input name="attr_inititive" type="text" /></div>
                        </div>
                        <div class="box-rounded">
                            <div>Speed</div>
                            <div><input name="attr_speed" type="text" /></div>
                        </div>
                        <div class="box-rounded">
                            <div>Temp.HP</div>
                            <div><input name="attr_temp_hp" type="text" /></div>
                        </div>
                        <div class="box-rounded">
                            <div>Proficiency Bonus</div>
                            <div><input type="text" name="attr_proficiency_bonus" /></div>
                        </div>
                        <div class="box-rounded">
                            <div>Death Saves</div>
                            <div style="display: flex;">
                                <span>Successes</span>
                                <input type="radio" name="attr_deaths_saves"/> 
                                <input type="radio" name="attr_deaths_saves"/> 
                                <input type="radio" name="attr_deaths_saves" />
                            </div>
                            <div style="display: flex;">
                                <span>Failures</span>
                                <input type="radio" name="attr_deaths_fails"/> 
                                <input type="radio" name="attr_deaths_fails"/> 
                                <input type="radio" name="attr_deaths_fails" />
                            </div>
                        </div>
                        <div class="box-rounded">
                            <div>Resistances</div>
                            <div><textarea name="attr_resistances"></textarea></div>
                        </div>
                    </div>
                    <div class="hit-points">
                        <input class="hp" type="number" name="attr_hp" />
                        <input class="max-hp" type="number" name="attr_max_hp" />
                        <input class="hit-dice" type="number" name="attr_hit_dice" />
                    </div>
                </div>
                <div>
                    <!-- MAIN STATS CONTAINER: -->
                    <div class="stats-main">
                        <!-- STRENGTH MOD: -->
                        <div class="strength">
                            <div><input type="text" name="attr_strength" /></div> 
                            <div><input value="0" type="text" name="attr_strength_mod" /></div> 
                        </div>
                        <!-- CHARISMA MOD: -->
                        <div class="charisma">
                            <div><input type="text" name="attr_charisma" /></div> 
                            <div><input value="0" type="text" name="attr_charisma_mod" /></div>
                        </div>
                        <!-- WISDOM MOD: -->
                        <div class="wisdom">
                            <div><input value="0" type="text" name="attr_wisdom_mod" /></div>
                            <div><input type="text" name="attr_wisdom" /></div>
                        </div>
                        <!-- INTELLIGENCE MOD: -->
                        <div class="intelligence">
                            <div><input value="0" type="text" name="attr_intelligence_mod" /></div>
                            <div><input type="text" name="attr_intelligence" /></div>
                        </div>
                        <!-- CONSTITUTION MOD: -->
                        <div class="constitution">
                            <div><input value="0" type="text" name="attr_constitution_mod" /></div>
                            <div><input type="text" name="attr_constitution" /></div>
                        </div>
                        <!-- DEXTERITY MOD: -->
                        <div class="dexterity">
                            <div><input type="text" name="attr_dexterity" /></div>
                            <div><input value="0" type="text" name="attr_dexterity_mod" /></div>
                        </div>
                    </div>
                    <hr>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Athletics:</span>
                            <input style="width: unset;" type="text" name="attr_athletics" />
                            <input type="checkbox" name="attr_athletics_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Acrobatics:</span>
                            <input style="width: unset;" type="text" name="attr_acrobatics" />
                            <input type="checkbox" name="attr_acrobatics_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Piloting: </span>
                            <input style="width: unset;" type="text" name="attr_piloting" />
                            <input type="checkbox" name="attr_piloting_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Sleight of hand: </span>
                            <input style="width: unset;" type="text" name="attr_sleight_of_hand" />
                            <input type="checkbox" name="attr_sleight_of_hand_prof" />
                        </div>
                    </div>              
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Stealth: </span>
                            <input style="width: unset" type="text" name="attr_stealth" />
                            <input type="checkbox" name="attr_stealth_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Arcana:</span>
                            <input style="width: unset" type="text" name="attr_arcana" />
                            <input type="checkbox" name="attr_arcana_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Data:</span>
                            <input style="width: unset" type="text" name="attr_data" />
                            <input type="checkbox" name="attr_data_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>History: </span>
                            <input style="width: unset" type="text" name="attr_history" />
                            <input type="checkbox" name="attr_history_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Investigation:</span>
                            <input style="width: unset" type="text" name="attr_investigation" />
                            <input type="checkbox" name="attr_investigation_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Nature:</span>
                            <input style="width: unset" type="text" name="attr_nature" />
                            <input type="checkbox" name="attr_nature_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Religion:</span>
                            <input style="width: unset" type="text" name="attr_religion" />
                            <input type="checkbox" name="attr_religion_prof" />
                            
                        </div>
                        <div class="attribute-group-item">
                            <span>Technology:</span>
                            <input style="width: unset" type="text" name="attr_technology" />
                            <input type="checkbox" name="attr_technology_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Animal Handling:</span>
                            <input style="width: unset" type="text" name="attr_animal_handling" />
                            <input type="checkbox" name="attr_animal_handling_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Insight:</span>
                            <input style="width: unset" type="text" name="attr_insight" />
                            <input type="checkbox" name="attr_insight_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Medicine:</span>
                            <input style="width: unset" type="text" name="attr_medicine" />
                            <input type="checkbox" name="attr_medicine_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Perception:</span>
                            <input style="width: unset" type="text" name="attr_perception" />
                            <input type="checkbox" name="attr_perception_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Survival:</span>
                            <input style="width: unset" type="text" name="attr_survival" />
                            <input type="checkbox" name="attr_survival_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Deception:</span>
                            <input style="width: unset" type="text" name="attr_deception" />
                            <input type="checkbox" name="attr_deception_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <span>Performance:</span>
                            <input style="width: unset" type="text" name="attr_performance" />
                            <input type="checkbox" name="attr_performance_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <span>Persuation:</span>
                            <input style="width: unset" type="text" name="attr_persuation" />
                            <input type="checkbox" name="attr_persuation_prof" />
                        </div>
                    </div>
                    <div class="attribute-group">
                        <div class="attribute-group-item">
                            <div style="display: inline;">Intimidation:</div>
                            <input style="width: unset" type="text" name="attr_intimidation" />
                            <input type="checkbox" name="attr_intimidation_prof" />
                        </div>
                        <div class="attribute-group-item">
                            <div></div>
                        </div>
                    </div>
                    <div class="box-rounded">
                        <div>Conditions</div>
                        <div><textarea name="attr_conditions" class="trait-block-textarea"></textarea></div>
                    </div>
                    
                    <div class="box-rounded">
                        <span>Passive Perception: = 10 + wisdom + profficiency bonus</span>
                        <input type="text" name="attr_passive_perception" />
                    </div>
                </div>
            </div>
            <div style="flex-grow: 1">
                <div class="trait-block left">
                    <div class="trait-block-corner-left"><div class="hexagon"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Racial/Class Features</div>
                    <div><textarea name="attr_racial_class_features" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="trait-block left">
                    <div class="trait-block-corner-left"><div class="hexagon"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Language/Proficiencies</div>
                    <div><textarea name="attr_language_proficiencies" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="trait-block left">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Flaws</div>
                    <div><textarea name="attr_flaws" class="trait-block-textarea"></textarea></div>
                </div>
                <div class="trait-block left">
                    <div class="trait-block-corner-left"><div class="hexagon hexagon--background"><div class="hexTop"></div><div class="hexBottom"></div></div></div>
                    <div class="trait-block-label">Inventory</div>
                    <div><textarea name="attr_inventory" class="trait-block-textarea"></textarea></div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function getAbilityScoreModifier(score) {
            if (score > 10) {
                return parseInt((score - 10) / 2);
            } else if (score < 10) {
                return (parseInt((10 - score) / 2)) * -1;
            } else {
                return 0;
            }
        }

        const attributes = [
            ["athletics", "strength"],
            ["acrobatics", "dexterity"],
            ["piloting", "dexterity"],
            ["sleight_of_hand", "dexterity"],
            ["stealth", "dexterity"],
            ["arcana", "intelligence"],
            ["data", "intelligence"],
            ["history", "intelligence"],
            ["investigation", "intelligence"],
            ["nature", "intelligence"],
            ["religion", "intelligence"],
            ["technology", "intelligence"],
            ["animal_handling", "wisdom"],
            ["insight", "wisdom"],
            ["medicine", "wisdom"],
            ["perception", "wisdom"],
            ["survival", "wisdom"],
            ["deception", "charisma"],
            ["performance", "charisma"],
            ["persuation", "charisma"],
            ["intimidation", "charisma"]
        ];

        const stats = [
            "strength",
            "charisma",
            "wisdom",
            "intelligence",
            "constitution",
            "dexterity"
        ];

        stats.forEach(function(stat) {
            on(`change:${stat}`, function() {
                getAttrs([stat], function(values) {               
                    setAttrs({ [`${stat}_mod`]: getAbilityScoreModifier(values[stat]) });
                });
                attributes.forEach(function(attribute) {
                    getAttrs([attribute[1], "proficiency_bonus", `${attribute[0]}_prof`], function(values) {    
                        setAttrs({ [`${attribute[0]}`]: values[`${attribute[0]}_prof`] === "on" ? 
                            Number(values["proficiency_bonus"] || 0) + getAbilityScoreModifier(values[attribute[1]]) :
                            getAbilityScoreModifier(values[attribute[1]])
                        });
                    });
                })
            });
        });
        // On checkbox prof check update the attribute
        attributes.forEach(function(attribute) {
            on(`change:${attribute[0]}_prof`, function(info) {
                // current stat related to attribute, profficiency modifier
                getAttrs([attribute[1], "proficiency_bonus"], function(values) {    
                    setAttrs({ [`${attribute[0]}`]: info.newValue === "on" ? 
                        Number(values["proficiency_bonus"] || 0) + getAbilityScoreModifier(values[attribute[1]]) :
                        getAbilityScoreModifier(values[attribute[1]])
                    });
                });
            });
        });
    </script>
</body>
</html>
